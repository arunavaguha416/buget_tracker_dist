import{u as T,a as F,b as S,r as c,j as e}from"./index-BtL-FlQ5.js";import{a as g}from"./axiosInstance-BzCA6i6Y.js";function k(){const{user:y}=T(),i=F(),{id:p}=S(),[n,d]=c.useState({transaction_type:"income",amount:"",category:"",date:"",description:""}),[v,N]=c.useState([]),[l,b]=c.useState(null),[f,o]=c.useState(""),[j,h]=c.useState("");c.useEffect(()=>{if(!y){i("/login");return}const t=async()=>{try{const s=await g.post("categories/list/",{});s.data.status&&N(s.data.records||[])}catch(s){console.error("Failed to fetch categories:",s),o("Failed to load categories")}},x=async()=>{var s,a;try{const r=await g.post("transactions/details/",{id:p});if(r.data.status){const m=r.data.records;d({transaction_type:m.transaction_type,amount:m.amount,category:m.category,date:m.date,description:m.description}),b(p)}else o(r.data.message||"Failed to fetch transaction details")}catch(r){console.error("Failed to fetch transaction:",r),o(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to fetch transaction details")}};t(),p&&x()},[y,i,p]);const u=t=>{d({...n,[t.target.name]:t.target.value}),o(""),h("")},w=async t=>{var x,s;t.preventDefault();try{if(l){const a=await g.put("transactions/update/",{id:l,...n});a.data.status?(h("Transaction updated successfully"),b(null),d({transaction_type:"income",amount:"",category:"",date:"",description:""}),i("/transactions")):o(a.data.message||"Failed to update transaction")}else{const a=await g.post("transactions/add/",n);a.data.status?(h("Transaction added successfully"),d({transaction_type:"income",amount:"",category:"",date:"",description:""}),i("/transactions")):o(a.data.message||"Failed to add transaction")}}catch(a){console.error("Failed to save transaction:",a),o(((s=(x=a.response)==null?void 0:x.data)==null?void 0:s.message)||"Failed to save transaction")}},C=()=>{b(null),d({transaction_type:"income",amount:"",category:"",date:"",description:""}),o(""),h(""),i("/transactions")};return e.jsxs("div",{className:"container mx-auto p-4 max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:l?"Edit Transaction":"Add Transaction"}),f&&e.jsx("p",{className:"text-red-600 mb-4",children:f}),j&&e.jsx("p",{className:"text-green-600 mb-4",children:j}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Type"}),e.jsxs("select",{name:"transaction_type",value:n.transaction_type,onChange:u,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Amount"}),e.jsx("input",{type:"number",step:"0.01",name:"amount",value:n.amount,onChange:u,className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Category"}),e.jsxs("select",{name:"category",value:n.category,onChange:u,className:"w-full p-2 border rounded",required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),v.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:n.date,onChange:u,className:"w-full p-2 border rounded",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Description"}),e.jsx("input",{type:"text",name:"description",value:n.description,onChange:u,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white p-2 rounded hover:bg-blue-700",children:l?"Update Transaction":"Add Transaction"}),l&&e.jsx("button",{type:"button",onClick:C,className:"bg-gray-600 text-white p-2 rounded hover:bg-gray-700",children:"Cancel"})]})]})]})}export{k as default};
