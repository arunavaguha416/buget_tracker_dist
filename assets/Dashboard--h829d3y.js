import{u as pt,a as gt,r as k,j as N}from"./index-CJTpyLdX.js";import{s as ct,o as mt}from"./transform-BbOsUIZc.js";import{a as xt}from"./axiosInstance-DVzUg7MC.js";const rt=Math.PI,ot=2*rt,C=1e-6,yt=ot-C;function dt(a){this._+=a[0];for(let n=1,r=a.length;n<r;++n)this._+=arguments[n]+a[n]}function $t(a){let n=Math.floor(a);if(!(n>=0))throw new Error(`invalid digits: ${a}`);if(n>15)return dt;const r=10**n;return function(s){this._+=s[0];for(let u=1,c=s.length;u<c;++u)this._+=Math.round(arguments[u]*r)/r+s[u]}}class vt{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?dt:$t(n)}moveTo(n,r){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,r){this._append`L${this._x1=+n},${this._y1=+r}`}quadraticCurveTo(n,r,s,u){this._append`Q${+n},${+r},${this._x1=+s},${this._y1=+u}`}bezierCurveTo(n,r,s,u,c,f){this._append`C${+n},${+r},${+s},${+u},${this._x1=+c},${this._y1=+f}`}arcTo(n,r,s,u,c){if(n=+n,r=+r,s=+s,u=+u,c=+c,c<0)throw new Error(`negative radius: ${c}`);let f=this._x1,t=this._y1,d=s-n,o=u-r,e=f-n,m=t-r,i=e*e+m*m;if(this._x1===null)this._append`M${this._x1=n},${this._y1=r}`;else if(i>C)if(!(Math.abs(m*d-o*e)>C)||!c)this._append`L${this._x1=n},${this._y1=r}`;else{let h=s-f,x=u-t,y=d*d+o*o,b=h*h+x*x,p=Math.sqrt(y),v=Math.sqrt(i),_=c*Math.tan((rt-Math.acos((y+i-b)/(2*p*v)))/2),$=_/v,M=_/p;Math.abs($-1)>C&&this._append`L${n+$*e},${r+$*m}`,this._append`A${c},${c},0,0,${+(m*h>e*x)},${this._x1=n+M*d},${this._y1=r+M*o}`}}arc(n,r,s,u,c,f){if(n=+n,r=+r,s=+s,f=!!f,s<0)throw new Error(`negative radius: ${s}`);let t=s*Math.cos(u),d=s*Math.sin(u),o=n+t,e=r+d,m=1^f,i=f?u-c:c-u;this._x1===null?this._append`M${o},${e}`:(Math.abs(this._x1-o)>C||Math.abs(this._y1-e)>C)&&this._append`L${o},${e}`,s&&(i<0&&(i=i%ot+ot),i>yt?this._append`A${s},${s},0,1,${m},${n-t},${r-d}A${s},${s},0,1,${m},${this._x1=o},${this._y1=e}`:i>C&&this._append`A${s},${s},0,${+(i>=rt)},${m},${this._x1=n+s*Math.cos(c)},${this._y1=r+s*Math.sin(c)}`)}rect(n,r,s,u){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+r}h${s=+s}v${+u}h${-s}Z`}toString(){return this._}}function j(a){return function(){return a}}const ht=Math.abs,T=Math.atan2,z=Math.cos,_t=Math.max,it=Math.min,L=Math.sin,Z=Math.sqrt,w=1e-12,O=Math.PI,U=O/2,K=2*O;function Mt(a){return a>1?0:a<-1?O:Math.acos(a)}function ft(a){return a>=1?U:a<=-1?-U:Math.asin(a)}function At(a){let n=3;return a.digits=function(r){if(!arguments.length)return n;if(r==null)n=null;else{const s=Math.floor(r);if(!(s>=0))throw new RangeError(`invalid digits: ${r}`);n=s}return a},()=>new vt(n)}function bt(a){return a.innerRadius}function Rt(a){return a.outerRadius}function Tt(a){return a.startAngle}function jt(a){return a.endAngle}function wt(a){return a&&a.padAngle}function Et(a,n,r,s,u,c,f,t){var d=r-a,o=s-n,e=f-u,m=t-c,i=m*d-e*o;if(!(i*i<w))return i=(e*(n-c)-m*(a-u))/i,[a+i*d,n+i*o]}function J(a,n,r,s,u,c,f){var t=a-r,d=n-s,o=(f?c:-c)/Z(t*t+d*d),e=o*d,m=-o*t,i=a+e,h=n+m,x=r+e,y=s+m,b=(i+x)/2,p=(h+y)/2,v=x-i,_=y-h,$=v*v+_*_,M=u-c,R=i*y-x*h,P=(_<0?-1:1)*Z(_t(0,M*M*$-R*R)),S=(R*_-v*P)/$,A=(-R*v-_*P)/$,I=(R*_+v*P)/$,E=(-R*v+_*P)/$,F=S-b,l=A-p,g=I-b,D=E-p;return F*F+l*l>g*g+D*D&&(S=I,A=E),{cx:S,cy:A,x01:-e,y01:-m,x11:S*(u/M-1),y11:A*(u/M-1)}}function Ft(){var a=bt,n=Rt,r=j(0),s=null,u=Tt,c=jt,f=wt,t=null,d=At(o);function o(){var e,m,i=+a.apply(this,arguments),h=+n.apply(this,arguments),x=u.apply(this,arguments)-U,y=c.apply(this,arguments)-U,b=ht(y-x),p=y>x;if(t||(t=e=d()),h<i&&(m=h,h=i,i=m),!(h>w))t.moveTo(0,0);else if(b>K-w)t.moveTo(h*z(x),h*L(x)),t.arc(0,0,h,x,y,!p),i>w&&(t.moveTo(i*z(y),i*L(y)),t.arc(0,0,i,y,x,p));else{var v=x,_=y,$=x,M=y,R=b,P=b,S=f.apply(this,arguments)/2,A=S>w&&(s?+s.apply(this,arguments):Z(i*i+h*h)),I=it(ht(h-i)/2,+r.apply(this,arguments)),E=I,F=I,l,g;if(A>w){var D=ft(A/i*L(S)),Q=ft(A/h*L(S));(R-=D*2)>w?(D*=p?1:-1,$+=D,M-=D):(R=0,$=M=(x+y)/2),(P-=Q*2)>w?(Q*=p?1:-1,v+=Q,_-=Q):(P=0,v=_=(x+y)/2)}var B=h*z(v),V=h*L(v),W=i*z(M),Y=i*L(M);if(I>w){var G=h*z(_),H=h*L(_),X=i*z($),tt=i*L($),q;if(b<O)if(q=Et(B,V,X,tt,G,H,W,Y)){var nt=B-q[0],et=V-q[1],at=G-q[0],st=H-q[1],lt=1/L(Mt((nt*at+et*st)/(Z(nt*nt+et*et)*Z(at*at+st*st)))/2),ut=Z(q[0]*q[0]+q[1]*q[1]);E=it(I,(i-ut)/(lt-1)),F=it(I,(h-ut)/(lt+1))}else E=F=0}P>w?F>w?(l=J(X,tt,B,V,h,F,p),g=J(G,H,W,Y,h,F,p),t.moveTo(l.cx+l.x01,l.cy+l.y01),F<I?t.arc(l.cx,l.cy,F,T(l.y01,l.x01),T(g.y01,g.x01),!p):(t.arc(l.cx,l.cy,F,T(l.y01,l.x01),T(l.y11,l.x11),!p),t.arc(0,0,h,T(l.cy+l.y11,l.cx+l.x11),T(g.cy+g.y11,g.cx+g.x11),!p),t.arc(g.cx,g.cy,F,T(g.y11,g.x11),T(g.y01,g.x01),!p))):(t.moveTo(B,V),t.arc(0,0,h,v,_,!p)):t.moveTo(B,V),!(i>w)||!(R>w)?t.lineTo(W,Y):E>w?(l=J(W,Y,G,H,i,-E,p),g=J(B,V,X,tt,i,-E,p),t.lineTo(l.cx+l.x01,l.cy+l.y01),E<I?t.arc(l.cx,l.cy,E,T(l.y01,l.x01),T(g.y01,g.x01),!p):(t.arc(l.cx,l.cy,E,T(l.y01,l.x01),T(l.y11,l.x11),!p),t.arc(0,0,i,T(l.cy+l.y11,l.cx+l.x11),T(g.cy+g.y11,g.cx+g.x11),p),t.arc(g.cx,g.cy,E,T(g.y11,g.x11),T(g.y01,g.x01),!p))):t.arc(0,0,i,M,$,p)}if(t.closePath(),e)return t=null,e+""||null}return o.centroid=function(){var e=(+a.apply(this,arguments)+ +n.apply(this,arguments))/2,m=(+u.apply(this,arguments)+ +c.apply(this,arguments))/2-O/2;return[z(m)*e,L(m)*e]},o.innerRadius=function(e){return arguments.length?(a=typeof e=="function"?e:j(+e),o):a},o.outerRadius=function(e){return arguments.length?(n=typeof e=="function"?e:j(+e),o):n},o.cornerRadius=function(e){return arguments.length?(r=typeof e=="function"?e:j(+e),o):r},o.padRadius=function(e){return arguments.length?(s=e==null?null:typeof e=="function"?e:j(+e),o):s},o.startAngle=function(e){return arguments.length?(u=typeof e=="function"?e:j(+e),o):u},o.endAngle=function(e){return arguments.length?(c=typeof e=="function"?e:j(+e),o):c},o.padAngle=function(e){return arguments.length?(f=typeof e=="function"?e:j(+e),o):f},o.context=function(e){return arguments.length?(t=e??null,o):t},o}function Nt(a){return typeof a=="object"&&"length"in a?a:Array.from(a)}function Pt(a,n){return n<a?-1:n>a?1:n>=a?0:NaN}function St(a){return a}function It(){var a=St,n=Pt,r=null,s=j(0),u=j(K),c=j(0);function f(t){var d,o=(t=Nt(t)).length,e,m,i=0,h=new Array(o),x=new Array(o),y=+s.apply(this,arguments),b=Math.min(K,Math.max(-K,u.apply(this,arguments)-y)),p,v=Math.min(Math.abs(b)/o,c.apply(this,arguments)),_=v*(b<0?-1:1),$;for(d=0;d<o;++d)($=x[h[d]=d]=+a(t[d],d,t))>0&&(i+=$);for(n!=null?h.sort(function(M,R){return n(x[M],x[R])}):r!=null&&h.sort(function(M,R){return r(t[M],t[R])}),d=0,m=i?(b-o*_)/i:0;d<o;++d,y=p)e=h[d],$=x[e],p=y+($>0?$*m:0)+_,x[e]={data:t[e],index:d,value:$,startAngle:y,endAngle:p,padAngle:v};return x}return f.value=function(t){return arguments.length?(a=typeof t=="function"?t:j(+t),f):a},f.sortValues=function(t){return arguments.length?(n=t,r=null,f):n},f.sort=function(t){return arguments.length?(r=t,n=null,f):r},f.startAngle=function(t){return arguments.length?(s=typeof t=="function"?t:j(+t),f):s},f.endAngle=function(t){return arguments.length?(u=typeof t=="function"?t:j(+t),f):u},f.padAngle=function(t){return arguments.length?(c=typeof t=="function"?t:j(+t),f):c},f}function zt(){const{user:a}=pt(),n=gt(),r=k.useRef(),[s,u]=k.useState({total_income:0,total_expenses:0,balance:0}),[c,f]=k.useState(""),[t,d]=k.useState(!1);return k.useEffect(()=>{if(!a){n("/login");return}(async()=>{var e,m;d(!0);try{const i=await xt.get("transactions/summary/");if(i.data.status){const{total_income:h,total_expenses:x,balance:y}=i.data.records;u({total_income:h,total_expenses:x,balance:y});const b=[{label:"Income",value:h},{label:"Expenses",value:x},{label:"Balance",value:y}];ct(r.current).selectAll("*").remove();const p=ct(r.current).append("svg").attr("width",400).attr("height",350),v=400,_=350,$=Math.min(v,_-50)/2,M=mt().domain(b.map(A=>A.label)).range(["#4caf50","#f44336","#2196f3"]),R=It().value(A=>A.value),P=Ft().innerRadius(0).outerRadius($-10),S=p.selectAll("arc").data(R(b)).enter().append("g").attr("transform",`translate(${v/2}, ${(_-50)/2})`);S.append("path").attr("d",P).attr("fill",A=>M(A.data.label)),S.append("text").attr("transform",A=>`translate(${P.centroid(A)})`).attr("text-anchor","middle").style("font-size","12px").text(A=>`${A.data.label}: ₹${A.data.value.toFixed(2)}`),p.append("text").attr("x",v/2).attr("y",20).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text("Financial Summary"),f("")}else f(i.data.message||"Failed to fetch financial data")}catch(i){console.error("Failed to fetch financial data:",i),f(((m=(e=i.response)==null?void 0:e.data)==null?void 0:m.message)||"Failed to fetch financial data")}finally{d(!1)}})()},[a,n]),N.jsxs("div",{className:"container mx-auto p-4",children:[N.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Financial Dashboard"}),c&&N.jsx("p",{className:"text-red-600 mb-4",children:c}),t?N.jsx("p",{children:"Loading..."}):N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"mb-4",children:[N.jsxs("p",{children:["Total Income: ₹",s.total_income.toFixed(2)]}),N.jsxs("p",{children:["Total Expenses: ₹",s.total_expenses.toFixed(2)]}),N.jsxs("p",{children:["Balance: ₹",s.balance.toFixed(2)]}),s.balance<0&&N.jsxs("p",{className:"text-red-600",children:["Warning: Your expenses exceed your income by ₹",Math.abs(s.balance).toFixed(2),"!"]})]}),N.jsx("div",{ref:r,className:"my-4"})]})]})}export{zt as default};
