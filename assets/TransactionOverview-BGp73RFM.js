import{u as k,a as A,r,j as e}from"./index-CJTpyLdX.js";import{a as b}from"./axiosInstance-DVzUg7MC.js";function D(){const{user:j}=k(),i=A(),[x,d]=r.useState([]),[t,u]=r.useState(1),[p,g]=r.useState(1),[N,o]=r.useState(""),[f,_]=r.useState([]),[s,C]=r.useState({date:"",category:"",transaction_type:"",amount_min:"",amount_max:""});r.useEffect(()=>{if(!j){i("/login");return}const a=async()=>{try{const n=await b.post("categories/list/",{});n.data.status&&_(n.data.records||[])}catch(n){console.error("Failed to fetch categories:",n),o("Failed to load categories")}},c=async()=>{var n,y;try{const m={page:t,page_size:10,date:s.date,category:s.category,transaction_type:s.transaction_type,amount_min:s.amount_min,amount_max:s.amount_max},h=await b.post("transactions/list/",m);if(h.data.status){const T=h.data.records.map(v=>({...v,type:v.transaction_type}));d(T),g(h.data.num_pages||1),o("")}else d([]),g(1),o(h.data.message||"Transactions not found")}catch(m){console.error("Failed to fetch transactions:",m),o(((y=(n=m.response)==null?void 0:n.data)==null?void 0:y.message)||"Failed to fetch transactions"),d([])}};a(),c()},[j,i,t,s]);const l=a=>{C({...s,[a.target.name]:a.target.value}),u(1)},w=a=>{i(`/transactions/edit/${a}`)},F=async a=>{try{await b.delete(`transactions/${a}/`),d(x.filter(c=>c.id!==a)),o("")}catch(c){console.error("Failed to delete transaction:",c),o("Failed to delete transaction")}};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Transaction Overview"}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>i("/transactions/add"),className:"bg-blue-600 text-white p-2 rounded hover:bg-blue-700 mb-4",children:"Add New Transaction"})}),N&&e.jsx("p",{className:"text-red-600 mb-4",children:N}),e.jsxs("div",{className:"mb-4 flex space-x-4 flex-wrap gap-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:s.date,onChange:l,className:"p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Category"}),e.jsxs("select",{name:"category",value:s.category,onChange:l,className:"p-2 border rounded",children:[e.jsx("option",{value:"",children:"All Categories"}),f.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Transaction Type"}),e.jsxs("select",{name:"transaction_type",value:s.transaction_type,onChange:l,className:"p-2 border rounded",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"income",children:"Income"}),e.jsx("option",{value:"expense",children:"Expense"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Min Amount"}),e.jsx("input",{type:"number",name:"amount_min",value:s.amount_min,onChange:l,className:"p-2 border rounded",placeholder:"Min amount"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Max Amount"}),e.jsx("input",{type:"number",name:"amount_max",value:s.amount_max,onChange:l,className:"p-2 border rounded",placeholder:"Max amount"})]})]}),x.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"p-2",children:"Type"}),e.jsx("th",{className:"p-2",children:"Amount"}),e.jsx("th",{className:"p-2",children:"Category"}),e.jsx("th",{className:"p-2",children:"Date"}),e.jsx("th",{className:"p-2",children:"Description"}),e.jsx("th",{className:"p-2",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:a.type}),e.jsxs("td",{className:"p-2",children:["â‚¹",parseFloat(a.amount).toFixed(2)]}),e.jsx("td",{className:"p-2",children:a.category_name}),e.jsx("td",{className:"p-2",children:a.date}),e.jsx("td",{className:"p-2",children:a.description}),e.jsxs("td",{className:"p-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>w(a.id),className:"text-blue-600 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>F(a.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},a.id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>u(a=>Math.max(a-1,1)),disabled:t===1,className:`p-2 rounded ${t===1?"bg-gray-300 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Previous"}),e.jsxs("span",{className:"self-center",children:["Page ",t," of ",p]}),e.jsx("button",{onClick:()=>u(a=>a+1),disabled:t>=p,className:`p-2 rounded ${t>=p?"bg-gray-300 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"Next"})]})]}):e.jsx("p",{children:"No transactions found."})]})}export{D as default};
